<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="geomex.xeus.smartcity.service.EventMapper">

	<select id="getList" parameterType="HashMap" resultType="EventHistVo">
		SELECT usvc_outb_id, evt_svc_nm, evt_typ, evt_typ_cd, msg_typ_cd, evt_nm, evt_cntn, outb_pos_nm, outb_posx, outb_posy, evt_outb_dtm, evt_clr_dtm, evt_proc_cd, evt_actn_dtm, evt_actn_usrid, evt_actn_cntn, test_yn, evt_json

		FROM xeus.mon_evet_list

		<where>
                AND evt_typ_cd <![CDATA[<>]]>  'CCTVLOCK'
			<if test="usvcOutbId != null and usvcOutbId != ''">
				AND usvc_outb_id = #{usvcOutbId}
			</if>
			<if test="uSvcOutbId != null and uSvcOutbId != ''">
				AND usvc_outb_id = #{uSvcOutbId}
			</if>


			<if test="evtSvcNm != null and evtSvcNm != ''">
				AND evt_svc_nm = #{evtSvcNm}
			</if>
			<if test="statEvetNm != null and statEvetNm != ''">
				AND evt_svc_nm = #{statEvetNm} OR evt_svc_nm = #{} 
			</if>


			<if test="evtTyp != null and evtTyp != ''">
				AND evt_typ = #{evtTyp}
			</if>
			<if test="statEvetType != null and statEvetType != ''">
				AND evt_typ = #{statEvetType}
			</if>


			<if test="evtTypCd != null and evtTypCd != ''">
				AND evt_typ_cd = #{evtTypCd}
			</if>
			<if test="statEvetTypCd != null and statEvetTypCd != ''">
				AND evt_typ_cd = #{statEvetTypCd}
			</if>


			<if test="msgTypCd != null and msgTypCd != ''">
				AND msg_typ_cd = #{msgTypCd}
			</if>
			<if test="statMsgTypCd != null and statMsgTypCd != ''">
				AND msg_typ_cd = #{statMsgTypCd}
			</if>


			<if test="evtNm != null and evtNm != ''">
				AND evt_nm = #{evtNm}
			</if>
			<if test="statEvetNm != null and statEvetNm != ''">
				AND evt_nm = #{statEvetNm}
			</if>


			<if test="evtCntn != null and evtCntn != ''">
				AND evt_cntn = #{evtCntn}
			</if>
			<if test="statEvetCntn != null and statEvetCntn != ''">
				AND evt_cntn = #{statEvetCntn}
			</if>


			<if test="outbPosNm != null and outbPosNm != ''">
				AND outb_pos_nm = #{outbPosNm}
			</if>


			<if test="outbPosx != null and outbPosx != ''">
				AND outb_posx = #{outbPosx}::numeric
			</if>


			<if test="outbPosy != null and outbPosy != ''">
				AND outb_posy = #{outbPosy}::numeric
			</if>


			<if test="evtOutbDtm != null and evtOutbDtm != ''">
				AND evt_outb_dtm = #{evtOutbDtm}
			</if>
			<if test="statEvetOutbDtmStart != null and statEvetOutbDtmStart != '' and statEvetOutbDtmEnd != null and statEvetOutbDtmEnd != ''">
				AND evt_outb_dtm BETWEEN #{statEvetOutbDtmStart}||'000000' AND #{statEvetOutbDtmEnd}||'235959'
			</if>

			<if test="evtClrDtm != null and evtClrDtm != ''">
				AND evt_clr_dtm = #{evtClrDtm}
			</if>
			<if test="statEvetClrDtm != null and statEvetClrDtm != ''">
				AND evt_clr_dtm = #{statEvetClrDtm}
			</if>


			<if test="evtProcCd != null and evtProcCd != ''">
				AND evt_proc_cd = #{evtProcCd}
			</if>
			<if test="procSt != null and procSt != ''">
				AND evt_proc_cd in ('10', '40')
			</if>


			<if test="evtActnDtm != null and evtActnDtm != ''">
				AND evt_actn_dtm = #{evtActnDtm}
			</if>
			<if test="statEvetActnDtm != null and statEvetActnDtm != ''">
				AND evt_actn_dtm = #{statEvetActnDtm}
			</if>


			<if test="evtActnUsrid != null and evtActnUsrid != ''">
				AND evt_actn_usrid = #{evtActnUsrid}
			</if>
			<if test="statEvetActnMn != null and statEvetActnMn != ''">
				AND evt_actn_usrid = #{statEvetActnMn}
			</if>


			<if test="evtActnCntn != null and evtActnCntn != ''">
				AND evt_actn_cntn = #{evtActnCntn}
			</if>
			<if test="statEvetActnCntn != null and statEvetActnCntn != ''">
				AND evt_actn_cntn = #{statEvetActnCntn}
			</if>


			<if test="testYn != null and testYn != ''">
				AND test_yn = #{testYn}
			</if>
			<if test="isTest != null and isTest != ''">
				AND test_yn = #{isTest}
			</if>

			<if test="evtJson != null and evtJson != ''">
				AND evt_json = #{evtJson}
			</if>
			<if test="etcCntn != null and etcCntn != ''">
				AND evt_json = #{etcCntn}
			</if>
			<if test="allNo != null and allNo != ''">
				AND evt_nm = #{allNo}
			</if>
			
			
			<if test="fifteen != null and fifteen != ''">
				OR evt_nm = #{fifteen}
			</if>
			<if test="eighteen != null and eighteen != ''">
				OR evt_nm = #{eighteen}
			</if>
			<if test="eight != null and eight != ''">
				OR evt_nm = #{eight}
			</if>
			<if test="six != null and six != ''">
				OR evt_nm = #{six}
			</if>
			<if test="zero != null and zero != ''">
				OR evt_nm = #{zero}
			</if>
			
			<if test="five != null and five != ''">
				OR evt_nm = #{five}
			</if>
			<if test="nine != null and nine != ''">
				OR evt_nm = #{nine}
			</if>
			<if test="two != null and two != ''">
				OR evt_nm = #{two}
			</if>
			
			
			<if test="rainWeak != null and rainWeak != ''">
				OR evt_nm = #{rainWeak}
			</if>
			<if test="rainStrong != null and rainStrong != ''">
				OR evt_nm = #{rainStrong}
			</if>
			<if test="snowWeak != null and snowWeak != ''">
				OR evt_nm = #{snowWeak}
			</if>
			<if test="snowStrong != null and snowStrong != ''">
				OR evt_nm = #{snowStrong}
			</if>
			
			
		</where>

		<trim prefix="ORDER BY">
			<if test="sortCol != null and sortCol != '' and sortTyp != null and sortTyp != ''">
				${sortCol} ${sortTyp}
			</if>
			<if test="sortCol == null and sortTyp == null">
				evt_outb_dtm desc
			</if>
		</trim>

		<if test="dataLimit != null and dataLimit != ''">

			LIMIT ${dataLimit}
		</if>
		<if test="limit != null and limit != '' and offset != null and offset != ''">

			LIMIT ${limit} OFFSET ${offset}
		</if>

	</select>

<!-- 	<select id="getListWithout" parameterType="HashMap" resultType="EventHistVo"> -->
<!-- 		SELECT usvc_outb_id, evt_svc_nm, evt_typ, evt_typ_cd, msg_typ_cd, evt_nm, evt_cntn, outb_pos_nm, outb_posx, outb_posy, evt_outb_dtm, evt_clr_dtm, evt_proc_cd, evt_actn_dtm, evt_actn_usrid, evt_actn_cntn, test_yn, evt_json -->

<!-- 		FROM xeus.mon_evet_list -->

<!-- 		<where> -->
<!-- 			<if test="procSt != null and procSt != ''"> -->
<!-- 				AND evt_proc_cd in ('10', '40') -->
<!-- 			</if> -->
<!-- 			<if test="list != null and list != ''"> -->
<!-- 				<foreach collection="list" item="item" open="AND " separator=" OR " close=""> -->
<!--             	(	 -->
<!--             		(evt_nm = #{item.evtNm})  -->
<!--             	) -->
<!--         		</foreach> -->
<!-- 			</if> -->
<!-- 		</where> -->

<!-- 		<if test="dataLimit != null and dataLimit != ''"> -->
<!-- 			LIMIT ${dataLimit} -->
<!-- 		</if> -->
<!-- 	</select> -->
	
	<select id="getItem" parameterType="HashMap" resultType="EventHistVo">
		SELECT usvc_outb_id, evt_svc_nm, evt_typ, evt_typ_cd, msg_typ_cd, evt_nm, evt_cntn, outb_pos_nm, outb_posx, outb_posy, evt_outb_dtm, evt_clr_dtm, evt_proc_cd, evt_actn_dtm, evt_actn_usrid, evt_actn_cntn, test_yn, evt_json

		FROM xeus.mon_evet_list

		<where>

			<if test="usvcOutbId != null and usvcOutbId != ''">
				AND usvc_outb_id = #{usvcOutbId}
			</if>
			<if test="uSvcOutbId != null and uSvcOutbId != ''">
				AND usvc_outb_id = #{uSvcOutbId}
			</if>


			<if test="evtSvcNm != null and evtSvcNm != ''">
				AND evt_svc_nm = #{evtSvcNm}
			</if>
			<if test="statEvetNm != null and statEvetNm != ''">
				AND evt_svc_nm = #{statEvetNm}
			</if>


			<if test="evtTyp != null and evtTyp != ''">
				AND evt_typ = #{evtTyp}
			</if>
			<if test="statEvetType != null and statEvetType != ''">
				AND evt_typ = #{statEvetType}
			</if>


			<if test="evtTypCd != null and evtTypCd != ''">
				AND evt_typ_cd = #{evtTypCd}
			</if>
			<if test="statEvetTypCd != null and statEvetTypCd != ''">
				AND evt_typ_cd = #{statEvetTypCd}
			</if>


			<if test="msgTypCd != null and msgTypCd != ''">
				AND msg_typ_cd = #{msgTypCd}
			</if>
			<if test="statMsgTypCd != null and statMsgTypCd != ''">
				AND msg_typ_cd = #{statMsgTypCd}
			</if>


			<if test="evtNm != null and evtNm != ''">
				AND evt_nm = #{evtNm}
			</if>
			<if test="statEvetNm != null and statEvetNm != ''">
				AND evt_nm = #{statEvetNm}
			</if>


			<if test="evtCntn != null and evtCntn != ''">
				AND evt_cntn = #{evtCntn}
			</if>
			<if test="statEvetCntn != null and statEvetCntn != ''">
				AND evt_cntn = #{statEvetCntn}
			</if>


			<if test="outbPosNm != null and outbPosNm != ''">
				AND outb_pos_nm = #{outbPosNm}
			</if>


			<if test="outbPosx != null and outbPosx != ''">
				AND outb_posx = #{outbPosx}::numeric
			</if>


			<if test="outbPosy != null and outbPosy != ''">
				AND outb_posy = #{outbPosy}::numeric
			</if>


			<if test="evtOutbDtm != null and evtOutbDtm != ''">
				AND evt_outb_dtm = #{evtOutbDtm}
			</if>
			<if test="statEvetOutbDtm != null and statEvetOutbDtm != ''">
				AND evt_outb_dtm like '%'||#{statEvetOutbDtm}||'%'
			</if>

			<if test="statEvetOutbDtmStart != null and statEvetOutbDtmStart != '' and statEvetOutbDtmEnd != null and statEvetOutbDtmEnd != ''">
				AND evt_outb_dtm BETWEEN #{statEvetOutbDtmStart}||'000000' AND #{statEvetOutbDtmEnd}||'235959'
			</if>

			<if test="evtClrDtm != null and evtClrDtm != ''">
				AND evt_clr_dtm = #{evtClrDtm}
			</if>

			<if test="statEvetClrDtm != null and statEvetClrDtm != ''">
				AND evt_clr_dtm = #{statEvetClrDtm}
			</if>


			<if test="evtProcCd != null and evtProcCd != ''">
				AND evt_proc_cd = #{evtProcCd}
			</if>
			<if test="procSt != null and procSt != ''">
				AND evt_proc_cd = #{procSt}
			</if>


			<if test="evtActnDtm != null and evtActnDtm != ''">
				AND evt_actn_dtm = #{evtActnDtm}
			</if>
			<if test="statEvetActnDtm != null and statEvetActnDtm != ''">
				AND evt_actn_dtm = #{statEvetActnDtm}
			</if>


			<if test="evtActnUsrid != null and evtActnUsrid != ''">
				AND evt_actn_usrid = #{evtActnUsrid}
			</if>
			<if test="statEvetActnMn != null and statEvetActnMn != ''">
				AND evt_actn_usrid = #{statEvetActnMn}
			</if>


			<if test="evtActnCntn != null and evtActnCntn != ''">
				AND evt_actn_cntn = #{evtActnCntn}
			</if>
			<if test="statEvetActnCntn != null and statEvetActnCntn != ''">
				AND evt_actn_cntn = #{statEvetActnCntn}
			</if>


			<if test="testYn != null and testYn != ''">
				AND test_yn = #{testYn}
			</if>
			<if test="isTest != null and isTest != ''">
				AND test_yn = #{isTest}
			</if>


			<if test="evtJson != null and evtJson != ''">
				AND evt_json = #{evtJson}
			</if>
			<if test="etcCntn != null and etcCntn != ''">
				AND evt_json = #{etcCntn}
			</if>
	
		</where>
	</select>

	<select id="getEventChk" parameterType="HashMap" resultType="EventHistVo">
		SELECT usvc_outb_id, evt_outb_dtm, evt_nm, evt_cntn

		FROM xeus.mon_evet_list

		<where>

			<if test="key != null and key != ''">
				AND usvc_outb_id like #{key}||'%'
			</if>

		</where>
	</select>


	<select id="getCount" parameterType="HashMap" resultType="int">
		SELECT count(*)

		FROM xeus.mon_evet_list

		<where>

			<if test="usvcOutbId != null and usvcOutbId != ''">
				AND usvc_outb_id = #{usvcOutbId}
			</if>
			<if test="uSvcOutbId != null and uSvcOutbId != ''">
				AND usvc_outb_id = #{uSvcOutbId}
			</if>


			<if test="evtSvcNm != null and evtSvcNm != ''">
				AND evt_svc_nm = #{evtSvcNm}
			</if>
			<if test="statEvetNm != null and statEvetNm != ''">
				AND evt_svc_nm = #{statEvetNm}
			</if>


			<if test="evtTyp != null and evtTyp != ''">
				AND evt_typ = #{evtTyp}
			</if>
			<if test="statEvetType != null and statEvetType != ''">
				AND evt_typ = #{statEvetType}
			</if>


			<if test="evtTypCd != null and evtTypCd != ''">
				AND evt_typ_cd = #{evtTypCd}
			</if>
			<if test="statEvetTypCd != null and statEvetTypCd != ''">
				AND evt_typ_cd = #{statEvetTypCd}
			</if>


			<if test="msgTypCd != null and msgTypCd != ''">
				AND msg_typ_cd = #{msgTypCd}
			</if>
			<if test="statMsgTypCd != null and statMsgTypCd != ''">
				AND msg_typ_cd = #{statMsgTypCd}
			</if>


			<if test="evtNm != null and evtNm != ''">
				AND evt_nm = #{evtNm}
			</if>
			<if test="statEvetNm != null and statEvetNm != ''">
				AND evt_nm = #{statEvetNm}
			</if>


			<if test="evtCntn != null and evtCntn != ''">
				AND evt_cntn = #{evtCntn}
			</if>
			<if test="statEvetCntn != null and statEvetCntn != ''">
				AND evt_cntn = #{statEvetCntn}
			</if>


			<if test="outbPosNm != null and outbPosNm != ''">
				AND outb_pos_nm = #{outbPosNm}
			</if>


			<if test="outbPosx != null and outbPosx != ''">
				AND outb_posx = #{outbPosx}::numeric
			</if>


			<if test="outbPosy != null and outbPosy != ''">
				AND outb_posy = #{outbPosy}::numeric
			</if>


			<if test="evtOutbDtm != null and evtOutbDtm != ''">
				AND evt_outb_dtm = #{evtOutbDtm}
			</if>

			<if test="statEvetOutbDtmStart != null and statEvetOutbDtmStart != '' and statEvetOutbDtmEnd != null and statEvetOutbDtmEnd != ''">
				AND evt_outb_dtm BETWEEN #{statEvetOutbDtmStart}||'000000' AND #{statEvetOutbDtmEnd}||'235959'
			</if>


			<if test="evtClrDtm != null and evtClrDtm != ''">
				AND evt_clr_dtm = #{evtClrDtm}
			</if>
			<if test="statEvetClrDtm != null and statEvetClrDtm != ''">
				AND evt_clr_dtm = #{statEvetClrDtm}
			</if>


			<if test="evtProcCd != null and evtProcCd != ''">
				AND evt_proc_cd = #{evtProcCd}
			</if>
			<if test="procSt != null and procSt != ''">
				AND evt_proc_cd = #{procSt}
			</if>


			<if test="evtActnDtm != null and evtActnDtm != ''">
				AND evt_actn_dtm = #{evtActnDtm}
			</if>
			<if test="statEvetActnDtm != null and statEvetActnDtm != ''">
				AND evt_actn_dtm = #{statEvetActnDtm}
			</if>


			<if test="evtActnUsrid != null and evtActnUsrid != ''">
				AND evt_actn_usrid = #{evtActnUsrid}
			</if>
			<if test="statEvetActnMn != null and statEvetActnMn != ''">
				AND evt_actn_usrid = #{statEvetActnMn}
			</if>


			<if test="evtActnCntn != null and evtActnCntn != ''">
				AND evt_actn_cntn = #{evtActnCntn}
			</if>
			<if test="statEvetActnCntn != null and statEvetActnCntn != ''">
				AND evt_actn_cntn = #{statEvetActnCntn}
			</if>


			<if test="testYn != null and testYn != ''">
				AND test_yn = #{testYn}
			</if>
			<if test="isTest != null and isTest != ''">
				AND test_yn = #{isTest}
			</if>


			<if test="evtJson != null and evtJson != ''">
				AND evt_json = #{evtJson}
			</if>
			<if test="etcCntn != null and etcCntn != ''">
				AND evt_json = #{etcCntn}
			</if>
			
			<if test="allNo != null and allNo != ''">
				AND evt_nm = #{allNo}
			</if>
			<if test="fifteen != null and fifteen != ''">
				OR evt_nm = #{fifteen}
			</if>
			<if test="eighteen != null and eighteen != ''">
				OR evt_nm = #{eighteen}
			</if>
			<if test="eight != null and eight != ''">
				OR evt_nm = #{eight}
			</if>
			<if test="six != null and six != ''">
				OR evt_nm = #{six}
			</if>
			<if test="zero != null and zero != ''">
				OR evt_nm = #{zero}
			</if>
			
			<if test="five != null and five != ''">
				OR evt_nm = #{five}
			</if>
			<if test="nine != null and nine != ''">
				OR evt_nm = #{nine}
			</if>
				<if test="two != null and two != ''">
				OR evt_nm = #{two}
			</if>

		</where>
	</select>


	<delete id="del" parameterType="HashMap">
		DELETE FROM xeus.mon_evet_list WHERE usvc_outb_id = #{uSvcOutbId}
	</delete>


	<insert id="add" parameterType="EventHistVo">
		INSERT INTO xeus.mon_evet_list(
			usvc_outb_id, evt_svc_nm, evt_typ, evt_typ_cd, msg_typ_cd, evt_nm, evt_cntn, outb_pos_nm, outb_posx, outb_posy, evt_outb_dtm, evt_clr_dtm, evt_proc_cd, evt_actn_dtm, evt_actn_usrid, evt_actn_cntn, test_yn, evt_json
		)
		SELECT 	#{usvcOutbId}, #{evtSvcNm}, #{evtTyp}, #{evtTypCd}, #{msgTypCd}, #{evtNm}, #{evtCntn}, #{outbPosNm}
<!-- 			null처리 -->
		,
			 <choose>
		        <when test="outbPosx != null and outbPosx != ''">
		             #{outbPosx}::numeric
		        </when>
		        <otherwise>
		          	 null
		        </otherwise>
             </choose>
		 ,
		 	 <choose>
		        <when test="outbPosy != null and outbPosy != ''">
		             #{outbPosy}::numeric
		        </when>
		        <otherwise>
		          	 null
		        </otherwise>
             </choose>
         ,
		 #{evtOutbDtm}, #{evtClrDtm}, #{evtProcCd}, #{evtActnDtm}, #{evtActnUsrid}, #{evtActnCntn}, #{testYn}, #{evtJson}

		       WHERE NOT EXISTS (SELECT 1 FROM xeus.mon_evet_list WHERE usvc_outb_id=#{usvcOutbId})
		       and NOT EXISTS (SELECT 1 FROM xeus.mon_evet_hist WHERE usvc_outb_id=#{usvcOutbId});

	</insert>


	<update id="edit" parameterType="EventHistVo">
		UPDATE xeus.mon_evet_list SET

				usvc_outb_id = #{usvcOutbId}

			<if test="evtSvcNm != null and evtSvcNm != ''">
				, evt_svc_nm = #{evtSvcNm}
			</if>


			<if test="evtTyp != null and evtTyp != ''">
				, evt_typ = #{evtTyp}
			</if>


			<if test="evtTypCd != null and evtTypCd != ''">
				, evt_typ_cd = #{evtTypCd}
			</if>


			<if test="msgTypCd != null and msgTypCd != ''">
				, msg_typ_cd = #{msgTypCd}
			</if>


			<if test="evtNm != null and evtNm != ''">
				, evt_nm = #{evtNm}
			</if>


			<if test="evtCntn != null and evtCntn != ''">
				, evt_cntn = #{evtCntn}
			</if>


			<if test="outbPosNm != null and outbPosNm != ''">
				, outb_pos_nm = #{outbPosNm}
			</if>


			<if test="outbPosx != null and outbPosx != ''">
				, outb_posx = #{outbPosx}::numeric
			</if>


			<if test="outbPosy != null and outbPosy != ''">
				, outb_posy = #{outbPosy}::numeric
			</if>


			<if test="evtOutbDtm != null and evtOutbDtm != ''">
				, evt_outb_dtm = #{evtOutbDtm}
			</if>


			<if test="evtClrDtm != null and evtClrDtm != ''">
				, evt_clr_dtm = #{evtClrDtm}
			</if>


			<if test="evtProcCd != null and evtProcCd != ''">
				, evt_proc_cd = #{evtProcCd}
			</if>


			<if test="evtActnDtm != null and evtActnDtm != ''">
				, evt_actn_dtm = #{evtActnDtm}
			</if>


			<if test="evtActnUsrid != null and evtActnUsrid != ''">
				, evt_actn_usrid = #{evtActnUsrid}
			</if>


			<if test="evtActnCntn != null and evtActnCntn != ''">
				, evt_actn_cntn = #{evtActnCntn}
			</if>


			<if test="testYn != null and testYn != ''">
				, test_yn = #{testYn}
			</if>


			<if test="evtJson != null and evtJson != ''">
				, evt_json = #{evtJson}
			</if>

		WHERE usvc_outb_id = #{usvcOutbId}

	</update>

</mapper>
